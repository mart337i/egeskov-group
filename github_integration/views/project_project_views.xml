<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_project_kanban_github" model="ir.ui.view">
        <field name="name">project.project.kanban.github</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="arch" type="xml">
            <!-- Add required fields to kanban view -->
            <xpath expr="//field[@name='sequence']" position="after">
                <field name="is_software_project"/>
                <field name="github_repo_url"/>
                <field name="last_deployment_status"/>
                <field name="last_deployment_date"/>
                <field name="last_commit_sha"/>
            </xpath>
            
            <!-- Add GitHub integration to footer -->
            <xpath expr="//footer/div[@class='d-flex ms-auto align-items-center']" position="inside">
                <div class="github_integration_kanban me-2" t-if="record.is_software_project.raw_value">
                    <div class="d-flex align-items-center gap-2">
                        <!-- Software Project Indicator -->
                        <span class="badge badge-info" title="Software Project">
                            <i class="fa fa-code me-1"></i>Dev
                        </span>
                        
                        <!-- Deployment Status Badge -->
                        <span t-if="record.last_deployment_status.raw_value and record.last_deployment_status.raw_value != 'unknown'" 
                              class="badge badge-sm deployment-status" 
                              t-attf-class="deployment-#{record.last_deployment_status.raw_value}"
                              t-att-title="record.last_deployment_date.value">
                            <i class="fa fa-rocket me-1"/>
                            <t t-esc="record.last_deployment_status.value"/>
                        </span>
                        
                        <!-- Commit Indicator -->
                        <span t-if="record.last_commit_sha.raw_value" 
                              class="badge badge-secondary" 
                              title="Latest Commit">
                            <i class="fa fa-git-commit me-1"/>
                            <t t-esc="record.last_commit_sha.value"/>
                        </span>
                        
                        <!-- GitHub Repository Link -->
                        <a t-if="record.github_repo_url.raw_value" 
                           t-attf-href="#{record.github_repo_url.raw_value}" 
                           target="_blank" 
                           class="btn btn-sm btn-outline-dark github-link"
                           title="Open GitHub Repository">
                            <i class="fa fa-github"/>
                        </a>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <record id="view_project_form_github" model="ir.ui.view">
        <field name="name">project.project.form.github</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="is_software_project"/>
                <field name="github_repository_id" invisible="is_software_project==False"
                       domain="['|', ('organization_id.is_active', '=', True), ('starred_by_org_ids.is_active', '=', True)]"/>
                <field name="github_repo_url" invisible="is_software_project==False"/>
            </xpath>
        </field>
    </record>
</odoo>